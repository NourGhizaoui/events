<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Event Form</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Arrière-plan plus professionnel */
        body {
            background-color: #eef2f5;
            font-family: 'Roboto', sans-serif;
            padding-top: 50px;
        }

        /* Conteneur de Formulaire */
        .form-container {
            max-width: 750px;
            margin: auto;
            background: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* Ombre plus prononcée */
            border-left: 5px solid #0d6efd; /* Bordure colorée */
        }

        /* Titre */
        .form-container h1 {
            font-weight: 700;
            margin-bottom: 30px;
            color: #343a40;
            text-align: left;
            border-bottom: 2px solid #f8f9fa;
            padding-bottom: 15px;
        }

        /* Labels et champs */
        label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
        }
        
        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            border-color: #0d6efd;
        }

        /* Bouton Enregistrer (Save) */
        .btn-save-custom {
            background-color: #28a745; /* Vert pour l'action principale (créer/sauver) */
            border-color: #28a745;
            color: white;
            padding: 10px 25px;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }

        .btn-save-custom:hover {
            background-color: #1e7e34;
            border-color: #1e7e34;
            color: white;
        }

        /* Bouton Retour (Back) */
        .btn-back-custom {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
            padding: 10px 25px;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }

        .btn-back-custom:hover {
            background-color: #5a6268;
            border-color: #545b62;
            color: white;
        }
        
        /* Style pour les icônes dans les labels (non utilisé ici, mais utile pour des améliorations futures) */
        /* label i {
            margin-right: 8px;
            color: #0d6efd;
        } */
    </style>
</head>

<body>

<div class="form-container">

    <h1 th:text="${event.id == null} ? 'Créer un nouvel événement' : 'Éditer l\'événement: ' + ${event.title}"></h1>

    <form th:action="@{/organisator/event/save}" th:object="${event}" method="post" id="eventForm">

        <input type="hidden" th:field="*{id}"/>

        <div class="mb-3">
            <label for="titleInput"><i class="fas fa-heading me-2"></i>Title:</label>
            <input type="text" id="titleInput" class="form-control" th:field="*{title}" required/>
        </div>

        <div class="mb-3">
            <label for="descriptionInput"><i class="fas fa-align-left me-2"></i>Description:</label>
            <textarea id="descriptionInput" class="form-control" th:field="*{description}" rows="4" required></textarea>
        </div>

        <div class="mb-3">
            <label for="eventDateInput"><i class="fas fa-calendar-alt me-2"></i>Date:</label>
            <input type="datetime-local" id="eventDateInput" class="form-control" th:field="*{eventDate}" required/>
            <div id="dateError" class="invalid-feedback d-none">
                La date de l'événement ne peut pas être antérieure à la date et heure actuelles.
            </div>
        </div>

        <div class="mb-3">
            <label for="locationInput"><i class="fas fa-map-marker-alt me-2"></i>Location:</label>
            <input type="text" id="locationInput" class="form-control" th:field="*{location}" required/>
        </div>

        <div class="mb-3">
            <label for="capacityInput"><i class="fas fa-users me-2"></i>Capacity:</label>
            <input type="number" id="capacityInput" class="form-control" th:field="*{capacity}" min="1" required/>
        </div>
		
		<div class="mb-3">
		    <label for="categorySelect"><i class="fas fa-tag me-2"></i>Category:</label>
		    <select id="categorySelect" class="form-select" th:field="*{category.id}" required>
		        <option value="" disabled>-- Sélectionner une catégorie --</option>
		        <option th:each="cat : ${categories}" 
		                th:value="${cat.id}" 
		                th:text="${cat.name}"
		                th:selected="${event.category != null and event.category.id == cat.id}">
		        </option>
		    </select>
		</div>


        <div class="d-flex justify-content-between mt-5">
            <a href="/organisator/dashboard" class="btn btn-back-custom px-5">
                <i class="fas fa-arrow-left me-2"></i> Retour
            </a>
            <button type="submit" class="btn btn-save-custom px-5">
                <i class="fas fa-save me-2"></i> Save
            </button>
        </div>

    </form>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('eventForm');
        const eventDateInput = document.getElementById('eventDateInput');
        const dateError = document.getElementById('dateError');

        // Fonction pour formater la date/heure actuelle
        function getNowString() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset()); // Ajuster au fuseau horaire local
            return now.toISOString().slice(0, 16); // Formatter en 'YYYY-MM-DDThh:mm'
        }

        // Si l'événement est nouveau, empêcher de choisir une date passée
        if ('[[${event.id}]]' === '') { // Vérifie si c'est une création
            eventDateInput.min = getNowString();
        }

        // Validation lors de la soumission du formulaire
        form.addEventListener('submit', function(event) {
            const selectedDate = new Date(eventDateInput.value).getTime();
            const now = new Date().getTime();

            // Vérifier si la date est dans le passé (avec une petite marge)
            if (selectedDate < now - (60000 * 5) ) { // Permettre 5 minutes de marge pour le traitement
                event.preventDefault(); // Empêcher la soumission
                eventDateInput.classList.add('is-invalid');
                dateError.classList.remove('d-none');
            } else {
                eventDateInput.classList.remove('is-invalid');
                dateError.classList.add('d-none');
            }
        });
        
        // Supprimer la validation d'erreur quand l'utilisateur change la valeur
        eventDateInput.addEventListener('change', function() {
            if (this.classList.contains('is-invalid')) {
                this.classList.remove('is-invalid');
                dateError.classList.add('d-none');
            }
        });
    });
</script>

</body>
</html>